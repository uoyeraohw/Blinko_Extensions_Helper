# 更新日志

本文档记录Blinko Chrome扩展的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 新增
- GitHub Actions 自动发布功能
  - 监听 manifest.json 变更自动触发发布
  - 跨平台兼容的打包脚本 (archiver)
  - 自动创建 GitHub Release 和上传 zip 文件
  - 完整的 Release Notes 生成

### 技术改进
- 新增 scripts/get-version.js - 版本号提取脚本
- 新增 scripts/pack.js - 跨平台打包脚本
- 替换 PowerShell 打包命令为 Node.js 脚本
- 添加 archiver 依赖用于跨平台压缩

## [1.1.0] - 2025-10-30

### 新增 - 可靠性功能增强
- 💾 **草稿自动保存系统**
  - 速写内容每2秒自动保存，防止意外丢失
  - 打开扩展时自动提示恢复未完成的草稿
  - 支持保存多个命名草稿，方便管理不同主题内容
  - 提交成功后自动清除草稿
  - 支持配置自动保存间隔和草稿保留时间
  
- 📦 **离线队列系统**
  - 网络不可用时自动将笔记加入离线队列
  - 基于IndexedDB存储，支持大量数据（降级支持Chrome Storage）
  - 智能重试策略：指数退避（1s, 2s, 4s, 8s, 16s, 32s）
  - 网络恢复后自动提交队列中的笔记
  - 区分可重试错误（网络、5xx）和不可重试错误（401、403）
  - 支持手动重试和批量操作
  - 自动清理成功项和定期维护
  
- 🖱️ **右键菜单扩展**
  - 保存整个页面为Markdown格式（包含标题、正文、来源）
  - 保存页面可视区域截图（支持S3上传或DataURL）
  - 使用特定模板快速总结页面（动态模板列表）
  - 优化菜单结构：分组显示、图标标识
  - 所有右键操作自动集成离线队列
  
- 📊 **存储配额管理**
  - 自动监控Chrome Storage和IndexedDB使用情况
  - 配额达到80%时警告，100%时阻止入队
  - 提供清理建议和一键清理功能
  - 详细显示草稿、队列、总配额使用情况

### 变更
- ♻️ `createNote` API现在支持metadata参数，用于队列追踪
- ♻️ 所有保存操作失败时会尝试入队（如果启用自动重试）
- ♻️ 速写Tab布局调整，增加草稿相关按钮

### 技术改进
- ✨ 新增3个工具模块：draft-manager、offline-queue、storage-quota
- ✨ 支持IndexedDB（降级Chrome Storage）
- ✨ 实现Service Worker定期任务（chrome.alarms）
- ✨ 实现网络状态监听和自动重试调度
- ✨ 完整的中英文国际化支持（新增70+条文本）

### 修复
- 无破坏性变更

## [1.0.0] - 之前版本

### 新增
- 🌍 **国际化支持（i18n）**：扩展现已完整支持中英双语
  - 自动语言检测：根据浏览器语言自动切换界面
  - 手动语言切换：在设置中可选择语言偏好
  - 完整翻译：200+ 界面文本的专业中英文翻译
  - 新增语言选择器：设置 > 通用设置 > 语言设置
  - 支持未来扩展更多语言（日语、韩语等）
- ✨ 模板管理新增AI优化功能，可将简单提示词转换为专业system prompt
- ✨ 采用场景引导型优化策略，智能识别特定网站（GitHub、知乎等）并提供针对性优化
- ✨ 一键优化：自动识别用户意图（总结、提取、分析等），保留核心需求的同时提升专业度

### 变更
- ♻️ **重要变更**：模板统一定位为system prompt，不再使用 `{{content}}` 占位符
  - 简化了模板系统，所有模板作为system prompt使用
  - 网页内容自动作为user message发送给AI
  - 更新了默认模板为专业的system prompt格式
- ♻️ 改进 S3 验证：使用 HeadBucket API 替代 ListObjectsV2
- ♻️ 改进 S3 签名：使用标准 AWS Signature V4 替代简化签名
- ✨ 实现真实的图片上传功能（PutObject API）
- 📦 引入 aws4fetch 库（通过 CDN，~2KB）
- 🔧 配置 Content Security Policy 支持 CDN 脚本加载

### 计划中的功能
- 划词保存功能完善
- 批注和高亮支持
- 离线模式
- 更多AI模型支持
- 浏览器书签同步
- 快捷键自定义

## [1.0.0] - 2024-XX-XX

### 新增
#### 核心功能
- ✨ 网页正文提取和Markdown转换
- ✨ AI智能内容总结（OpenAI兼容API）
- ✨ 快速笔记（速写）功能
- ✨ 右键菜单快捷操作

#### 设置与配置
- ⚙️ Blinko服务配置和连通性验证
- ⚙️ OpenAI服务配置和测试
- ⚙️ 提示词模板管理系统
- ⚙️ 域名特定模板规则
- ⚙️ 场景标签配置
- ⚙️ S3图片存储配置
- ⚙️ 配置导入/导出功能

#### 模板系统
- 📝 自定义总结模板
- 📝 {{content}}变量支持
- 📝 域名规则匹配（正则、主域名、完整URL）
- 📝 默认模板设置

#### 图片处理
- 🖼️ 图片链接保留选项
- 🖼️ S3存储上传（完整实现，使用 AWS Signature V4）
- 🖼️ 支持 AWS S3、MinIO、阿里云 OSS、腾讯云 COS
- 🖼️ CDN加速支持
- 🖼️ 批量图片处理

#### 用户界面
- 🎨 简洁现代的Popup界面
- 🎨 完整的设置页面（6个Tab）
- 🎨 实时状态反馈
- 🎨 加载动画
- 🎨 响应式设计

#### 右键菜单
- 🖱️ 保存选中文本
- 🖱️ 保存图片
- 🖱️ 保存链接

### 技术特性
- 📦 Manifest V3 支持
- 🔧 Chrome Storage API集成
- 🔧 Content Script内容提取
- 🔧 Service Worker后台处理
- 🔧 模块化代码架构

### 优化
- ⚡ HTML转Markdown性能优化
- ⚡ 图片批量处理并发控制
- ⚡ API请求重试机制
- ⚡ 缓存常用配置

### 安全
- 🔒 API密钥加密存储
- 🔒 配置导出脱敏处理
- 🔒 XSS防护
- 🔒 权限最小化

### 文档
- 📚 完整的用户文档（README.md）
- 📚 开发者文档（DEVELOPMENT.md）
- 📚 测试指南（TESTING.md）
- 📚 发布指南（RELEASE.md）
- 📚 OpenSpec规格文档

### 已知限制
- ⚠️ 某些复杂网页结构可能提取不准确
- ⚠️ AI总结依赖外部API，响应时间取决于服务质量
- ⚠️ S3 功能需要网络访问 CDN（jsdelivr.net）加载 aws4fetch 库

---

## 版本说明

### 版本号格式
`主版本号.次版本号.修订号`

- **主版本号**：重大功能变更，可能不向后兼容
- **次版本号**：新增功能，向后兼容
- **修订号**：Bug修复和小优化，向后兼容

### 变更类型
- `新增` - 新功能
- `变更` - 现有功能的变化
- `废弃` - 即将移除的功能
- `移除` - 已移除的功能
- `修复` - Bug修复
- `安全` - 安全相关修复
- `优化` - 性能或代码优化

---

## 反馈

发现问题或有建议？请通过以下方式反馈：
- GitHub Issues
- 邮件联系

感谢您使用Blinko Chrome扩展！

